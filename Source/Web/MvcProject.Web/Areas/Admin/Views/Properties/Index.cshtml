@using MvcProject.Web.Infrastructure.HtmlHelpers
@using MvcProject.Web.Areas.Admin.ViewModels.Properties

@model PropertyForeignKeysViewModel

@{
    ViewBag.Title = "Properties (ADMIN)";
    //var culture = System.Globalization.CultureInfo.CurrentCulture.ToString();
}

@(Html.FullFeaturedGrid<PropertyViewModel>(
    gridName: "propertiesGrid",
    controllerName: "Properties",
    routeValues: new { Area = "Admin" },
    model: m =>
    {
        m.Id(p => p.Id);
        m.Field(p => p.Id).Editable(false);
    },
    pageSize: 20,
    virtualScroll: false,
    columns: c =>
    {
        //c.Command(cm => cm.Edit().UpdateText("Save")).Width("100px");
        //c.Command(cm => cm.Destroy().Text("Delete")).Width("120px");
        c.Bound(m => m.Id).Width("150px");
        c.Bound(m => m.Name);
        c.Bound(m => m.Value);
        c.Bound(m => m.DescriptionId);
        //c.ForeignKey(m => m.DescriptionId, Model.Descriptions, "Id", "Id");
        c.Bound(m => m.CreatedOn).Format("{0:dd/MM/yyyy h:mm:ss}");
        c.Bound(m => m.ModifiedOn).Format("{0:dd/MM/yyyy h:mm:ss}");
        c.Bound(m => m.IsDeleted).Title("Marked As Deleted");
        c.Bound(m => m.DeletedOn).Format("{0:dd/MM/yyyy h:mm:ss}");
    },
    dataSourceEvents: events =>
    {
        events
            .Error("errorHandler.handler")
            ;
    },
    isBatch: false,
    editingSettings: e =>
    {
        e.Mode(GridEditMode.InCell);
    },
    htmlAttributes: new { @class = "admin-grid" },
    //readHandler: "dataHandler",
    createHandler: "dataHandler",
    updateHandler: "dataHandler"
    )
    .ToolBar(t => t.Save())
    .Selectable()
    .AllowCopy(true)
    .Deferred())

@section styles{
    <style>
        /*horizontal Grid scrollbar should appear if the browser window is shrinked too much*/
        #propertiesGrid table {
            width: 2000px;
        }
    </style>

    <link href="@Url.Content("~/Content/Custom/Admin/main-grid.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/Custom/Admin/custom-popup-editor.css")" rel="stylesheet" type="text/css" />
}

@section Scripts{
    @(Html.Kendo().DeferredScripts())

    <script src="@Url.Content("~/Scripts/Custom/error-handler.js")"></script>
    @*<script src="@Url.Content("~/Scripts/Kendo/cultures/kendo.culture." + culture + ".min.js")"></script>*@
    <script src="@Url.Content("~/Scripts/Custom/datetime-handlers.js")"></script>

    <script>
        kendo.culture("@BundleConfig.UiCulture");
        
        function dataHandler(data) {
            datetimeHandlers.normalizeDateProperties(data);
        }
    </script>
}
