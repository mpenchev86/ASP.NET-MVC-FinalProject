@using MvcProject.Web.Areas.Public.ViewModels.Images
@using MvcProject.Web.Areas.Public.ViewModels.Products
@using MvcProject.Web.Areas.Public.ViewModels.Properties

@model ProductFullViewModel

@{
    ViewBag.Title = Model.Title;
}

<div class="row product-full-view">
    <div id="product-images" class="col-md-7">
        @Html.Partial(
            "_ProductImages",
            new ProductImagesPartialViewModel
            {
                //MainImageId = Model.MainImageId,
                Images = Model.Images ?? new List<ImageForProductFullViewModel>()
            },
            null)
    </div>
    <div id="product-sidebar" class="col-md-5">
        @Html.Partial(
            "_ProductSideBar",
            new ProductSideBarPartialViewModel
            {
                Title = Model.Title,
                Category = Model.Category.Name,
                UnitPrice = Model.UnitPrice,
                ShippingPrice = Model.ShippingPrice,
                QuantityInStock = Model.QuantityInStock,
                IsInStock = Model.IsInStock,
                RefNumber = Model.EncodedId,
                Rating = Model.AllTimeAverageRating ?? 0,
                SellerName = Model.SellerName
            },
            null)
    </div>
</div>
<div class="row product-full-view" id="product-info">
    @Html.Partial(
        "_ProductInfo",
        new ProductInfoPartialViewModel()
        {
            DescriptionContent = Model.Description != null ? Model.Description.Content : string.Empty,
            DescriptionProperties = Model.Description != null ? Model.Description.Properties : new List<PropertyForProductFullViewModel>(),
            Tags = Model.Tags
        },
        null)
</div>
<div class="row product-full-view" id="product-comments">
    @Html.Partial("_ProductCommentsWithRatings", Model.CommentsWithRatings, null)
</div>

@*@section Styles{
    <link href="@Url.Content(StaticResourcesUrls.ProductFullViewmodel)" rel="stylesheet" type="text/css" />
}*@

@section Scripts{
    <script src="@Url.Content(StaticResourcesUrls.IgniteUiRatingHandler)"></script>

    <script>
        //$(document).ready(function InitializeRatings() {
        //    ratingHandler.configureDisplayWidgets("#igRating");
        //    //$("#igRating1").igRating("option", "value", 3.5);
        //    var rating = $("#igRating0");
        //    console.log(rating);
        //})

        ////Bind after initialization
        //$(document).delegate("#igRating5", "igratinghoverchange", function (evt, ui) {
        //    //return the triggered event
        //    evt;
     
        //    //the value before the igRating was hovered 
        //    ui.oldValue;
        //    //the current hover value
        //    ui.value;
        //});  
 
        ////Initialize
        //$(".selector").igRating({
        //    hoverChange : function(evt, ui) {...}
        //});

        $('a.small-image').on('click', function onSmallImageClick(e) {
            e.preventDefault();
        });

        $('a.small-image').on('mouseenter', function onSmallImageMouseEnter(e) {
            e.preventDefault();

            var link = $(this),
                newSrc = link.attr('href'),
                image = $('#mainImage'),
                dateSuffix = new Date();

            //image.onload = function () {
            //    console.log('pesho');
            //    image.hide("fast", function () {
            //        image.attr("src", newSrc + "?" + dateSuffix.getTime()).show();
            //    });
            //}

            image.attr("src", newSrc + "?" + dateSuffix.getTime());

            //console.log(image);
        });
    </script>
}