@using MvcProject.Web.Areas.Public.ViewModels.Images
@using MvcProject.Web.Areas.Public.ViewModels.Products
@using MvcProject.Web.Areas.Public.ViewModels.Properties

@model ProductFullViewModel

@{
    ViewBag.Title = Model.Title;
}

<div class="row product-full-view">
    <div id="product-images" class="col-md-7">
        @Html.Partial(
            "_ProductImages",
            new ProductImagesPartialViewModel
            {
                //MainImageId = Model.MainImageId,
                Images = Model.Images ?? new List<ImageForProductFullViewModel>()
            },
            null)
    </div>
    <div id="product-sidebar" class="col-md-5">
        @Html.Partial(
            "_ProductSideBar",
            new ProductSideBarPartialViewModel
            {
                Title = Model.Title,
                Category = Model.Category.Name,
                UnitPrice = Model.UnitPrice,
                ShippingPrice = Model.ShippingPrice,
                QuantityInStock = Model.QuantityInStock,
                IsInStock = Model.IsInStock,
                RefNumber = Model.EncodedId,
                Rating = Model.AllTimeAverageRating ?? 0,
                SellerName = Model.SellerName
            },
            null)
    </div>
</div>
<div class="row product-full-view" id="product-info">
    @Html.Partial(
        "_ProductInfo",
        new ProductInfoPartialViewModel()
        {
            DescriptionContent = Model.Description != null ? Model.Description.Content : string.Empty,
            DescriptionProperties = Model.Description != null ? Model.Description.Properties : new List<PropertyForProductFullViewModel>(),
            Tags = Model.Tags
        },
        null)
</div>
<div class="row product-full-view" id="product-comments">
    @Html.Partial("_ProductCommentsWithRatings", Model.CommentsWithRatings, null)
</div>

@*@section Styles{
    <link href="@Url.Content(StaticResourcesUrls.ProductFullViewmodel)" rel="stylesheet" type="text/css" />
}*@

@section Scripts{
    <script src="@Url.Content(StaticResourcesUrls.IgniteUiRatingHandler)"></script>
    <script src="@Url.Content(StaticResourcesUrls.BootstrapModalHelpers)"></script>

    <script>
        $('a.small-image').on('click', function onSmallImageClick(e) {
            e.preventDefault();
        });

        $('a.small-image').on('mouseenter', function onSmallImageMouseEnter(e) {
            e.preventDefault();

            var link = $(this),
                newSrc = link.attr('href'),
                image = $('#image-in-focus'),
                largeImgLink = link.next('.large-image-link'),
                largeHref = largeImgLink.attr('href'),
                dateSuffix = new Date();

            image.attr("src", newSrc + "?" + dateSuffix.getTime());
            $('#modal-link').attr('href', largeHref + "?" + dateSuffix.getTime());
        });

        // Get the modal
        var modal = document.getElementById('large-image-modal');
        // Get the image and insert it inside the modal - use its "alt" text as a caption
        var img = document.getElementById('image-in-focus');
        var modalImg = document.getElementById("large-image");
        img.onclick = function () {
            // Disables browser scrolling while jQuery UI modal dialog is open
            $('body').css('overflow', 'hidden');
            modal.style.display = "block";
            //$('#large-image-modal').modal({ keyboard: true });
            //modal.modal({ backdrop: 'false' });
            modalImg.src = $('#modal-link').attr('href');
        }

        //// Get the <span> element that closes the modal
        //var span = document.getElementsByClassName("close-modal")[0];

        //// When the user clicks on <span> (x), close the modal
        //span.onclick = function () {
        //    modal.style.display = "none";
        //    // Enables browser scrolling when modal dialog is closed
        //    $('body').css('overflow', 'scroll');
        //}

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>
}